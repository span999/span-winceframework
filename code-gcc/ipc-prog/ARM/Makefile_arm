
CC	= /home/span/workshop/bin/toolchains/freescale/gcc-4.4.4-glibc-2.11.1-multilib-1.0/arm-fsl-linux-gnueabi/bin/arm-fsl-linux-gnueabi-gcc
DEFINES =
CFLAGS	= -O2 -I. -L. ${DEFINES}

AR	= /home/span/workshop/bin/toolchains/freescale/gcc-4.4.4-glibc-2.11.1-multilib-1.0/arm-fsl-linux-gnueabi/bin/arm-fsl-linux-gnueabi-ar
ARFLAG = rcs

PROGRAM	= testcode
DYNLIB1  = libtest.so
DYNLIB2  = libipc.so
STATICLIB1  = libtest


all: clean PROGRAM

#
# export LD_LIBRARY_PATH=.
# if you got error while loading shared linraries
#


DYNLIB1: STATICLIB1
	@echo 
	@echo ================================================================
	@echo build dynamic library ${DYNLIB1}
	@echo ----------------------------------------------------------------
	${CC} ../so_test.c -fPIC -shared -o ${DYNLIB1}

DYNLIB2:
	@echo 
	@echo ================================================================
	@echo build dynamic library ${DYNLIB2}
	@echo ----------------------------------------------------------------
	${CC} ../so_ipc.c -fPIC -shared -o ${DYNLIB2}

STATICLIB1:
	@echo ================================================================
	$(CC) $(CFLAGS) -c ../so_ipc.c
	$(AR) $(ARFLAG) $(STATICLIB1).a so_ipc.o


PROGRAM: DYNLIB1 DYNLIB2
	@echo 
	@echo ================================================================
	@echo 
	@echo build binary. ${PROGRAM}
	@echo   use export LD_LIBRARY_PATH=. for linrary path setting!! 
	@echo 
	@echo ----------------------------------------------------------------
	${CC} ../main.c ${DYNLIB1}  ${DYNLIB2} -o ${PROGRAM} -lpthread

clean:
	@echo 
	@echo ================================================================
	@echo Erasing objects and backup files.
	@echo ----------------------------------------------------------------
	rm -f ${PROGRAM} *.so *.o
