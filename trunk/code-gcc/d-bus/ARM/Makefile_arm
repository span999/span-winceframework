#
#
#
### dbus-glib build env install
### install dbus #
# apt-get install dbus
### install d-feet for session bus & system bus #
# apt-get install d-feet
### install glib2.0 #
# apt-get install libgtk2.0-dev
### install dbus-glib #
# apt-get install libdbus-glib-1-dev 
#
#

CPU = arm
ROOTFS = /home/span/workshop/build/trial/ltib/rootfs
TOOLCHAINPREFIX = /home/span/workshop/bin/toolchains/freescale/gcc-4.4.4-glibc-2.11.1-multilib-1.0/arm-fsl-linux-gnueabi/bin/arm-fsl-linux-gnueabi-

CC      = ${TOOLCHAINPREFIX}gcc
AR      = ${TOOLCHAINPREFIX}ar
DEFINES =
CFLAGS+= -O2 -I. -L${ROOTFS}/usr/lib ${DEFINES}
#CFLAGS+="$(pkg-config dbus-1 --cflags)"

OUTBIN1 = dbus_${CPU}.bin
OUTBIN2 = sample_${CPU}.bin
#DBUSINC = $(pkg-config dbus-1 --cflags)
DBUSINC = -I${ROOTFS}/usr/include/dbus-1.0 -I${ROOTFS}/usr/lib/dbus-1.0/include
DBUSLIB = -l dbus-1
PROGRAM = ../dbus.c
SAMPLE = ../dbus-example.c
DYNLIB  = libtest.so
STATICLIB = libcpuutil.a
STATICNAME = cpuutil


all: clean PROGRAM SAMPLE


STATICLIB:
	@echo 
	@echo ================================================================
	@echo build static library
	@echo ----------------------------------------------------------------
	${CC} -c ${STATICNAME}.c
	${AR} rcs ${STATICLIB} ${STATICNAME}.o

DYNLIB:
	@echo 
	@echo ================================================================
	@echo build dynamic library
	@echo ----------------------------------------------------------------
	${CC} so_test.c -fPIC -shared -o ${DYNLIB}

PROGRAM: 
	@echo 
	@echo ================================================================
	@echo build binary = ${OUTBIN1}
	@echo ----------------------------------------------------------------
	${CC} ${PROGRAM} -o ${OUTBIN1} -lpthread ${DBUSINC} ${DBUSLIB} ${CFLAGS}
#	${CC} ${PROGRAM} -o ${OUTBIN1} -lpthread ${CFLAGS}

SAMPLE: 
	@echo 
	@echo ================================================================
	@echo build binary = ${OUTBIN2}
	@echo ----------------------------------------------------------------
	${CC} ${SAMPLE} -o ${OUTBIN2} -lpthread ${DBUSINC} ${DBUSLIB} ${CFLAGS}
#	${CC} ${PROGRAM} -o ${OUTBIN2} -lpthread ${CFLAGS}

clean:
	@echo 
	@echo ================================================================
	@echo Erasing objects and backup files.
	@echo ----------------------------------------------------------------
	rm -f ${OUTBIN1} ${OUTBIN2} *.so *.o *.a
